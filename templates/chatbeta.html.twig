{% extends 'layout.html.twig' %}

{% block title %}
	{{ parent()}}
	- Accueil
{% endblock %}


{% block body %}

	<div class="container"> 
		<div id="zonemessage"></div>

		<label for="msg">MSG</label>
		<input type="text" id="msg" name="lastname">

		<button  onclick="send()">ENVOYER</button>

        <button  onclick="subscribe('groupe1')">Se joindre au groupe 1</button>
        <button  onclick="subscribe('groupe2')">Se joindre au groupe 2</button>

	</div>


	<script>

        /* ZONE DE TEST NE PAS OUBLIER DE LANCER Le serveur de websocket pour que Ã§a marche */
		let zonemessage = document.getElementById('zonemessage');
        let conn = new WebSocket('ws://localhost:8080');

        conn.onopen = function (e) {
        console.log("Connection established!"); 
        };
        conn.onmessage = function (e) { 
        zonemessage.append(e.data);
        
        };

 
        function subscribe(channel) {
            console.log("join : ", channel)
            conn.send(JSON.stringify({command: "subscribe", channel: channel}));
        }


        function send() {
        msg = document.getElementById("msg").value;

        zonemessage.append(msg);
         
        conn.send(JSON.stringify({command: "message", message: msg}));
        }
	</script>
    

{% endblock %}
